# Package information
PKGNAME         := gm2calc
VERSION         := 0.0.0

# Variables for compilation
CXX             := g++
CPPFLAGS        := -I. -Isrc
CXXFLAGS        := -O2 -std=c++11
CXX_DEP_GEN     := g++
FC              := gfortran
FFLAGS          := -O2 -frecursive
FLIBS           := -lgfortran -lm
FOR_DEP_GEN     := gfortran
MAKELIB         := ar cru
BLASLIBS        := -lblas
BOOSTFLAGS      := -I/usr/include
EIGENFLAGS      := -I/usr/include/eigen3
LAPACKLIBS      := -llapack -lblas
LIBEXT          := .a
BINDIR          := bin

.PHONY:         all allexec alllib clean depend

all: alllib allexec

clean::
	-rm -f config.h

include src/module.mk

ifneq ($(MAKECMDGOALS),clean)
ifneq ($(MAKECMDGOALS),depend)
ifeq ($(findstring print-,$(MAKECMDGOALS)),)
-include $(ALLDEP)
endif
endif
endif

allexec:  $(ALLEXE)
alllib:   $(ALLLIB)
depend:   $(ALLDEP)

$(BINDIR):
	mkdir $(BINDIR)

config.h: Makefile
	rm -f $@-t $@
	{ echo '/* DO NOT EDIT! GENERATED AUTOMATICALLY! */'; \
	  echo ''; \
	  echo '/* program version */'; \
	  echo '#define GM2CALC_VERSION "$(VERSION)"'; \
	} | sed '/""/d' > $@-t
	mv $@-t $@

%.d: %.cpp
	$(CXX_DEP_GEN) $(CPPFLAGS) -MM -MP -MG -o $@ -MT '$*.o' $^

%.d: %.f
	$(FOR_DEP_GEN) $(CPPFLAGS) -cpp -MM -MP -MG $^ -MT '$*.o' | \
	sed 's|.*\.o:|$*.o:|' > $@

print-% : ; @echo $* = $($*)
