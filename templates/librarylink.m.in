lib@ModelName@ = FileNameJoin[{Directory[], "models", "@ModelName@", "@ModelName@_librarylink.so"}];

FS@ModelName@OpenHandleLib = LibraryFunctionLoad[lib@ModelName@, "FS@ModelName@OpenHandle", {{Real,1}}, Integer];
FS@ModelName@CalculateSpectrum = LibraryFunctionLoad[lib@ModelName@, "FS@ModelName@CalculateSpectrum", {Integer}, Void];
FS@ModelName@CloseHandle = LibraryFunctionLoad[lib@ModelName@, "FS@ModelName@CloseHandle", {Integer}, Void];

fsDefaultSettings = {
      precisionGoal -> 1.*^-4,           (* FlexibleSUSY[0] *)
      maxIterations -> 0,                (* FlexibleSUSY[1] *)
      calculateStandardModelMasses -> 0, (* FlexibleSUSY[3] *)
      poleMassLoopOrder -> 2,            (* FlexibleSUSY[4] *)
      ewsbLoopOrder -> 2,                (* FlexibleSUSY[5] *)
      betaFunctionLoopOrder -> 2,        (* FlexibleSUSY[6] *)
      thresholdCorrectionsLoopOrder -> 2,(* FlexibleSUSY[7] *)
      higgs2loopCorrectionAtAs -> 1,     (* FlexibleSUSY[8] *)
      higgs2loopCorrectionAbAs -> 1,     (* FlexibleSUSY[9] *)
      higgs2loopCorrectionAtAt -> 1,     (* FlexibleSUSY[10] *)
      higgs2loopCorrectionAtauAtau -> 1, (* FlexibleSUSY[11] *)
      forceOutput -> 0,                  (* FlexibleSUSY[12] *)
      top2loopCorrectionsQCD -> 1,       (* FlexibleSUSY[13] *)
      betaZeroThreshold -> 1.*^-11,      (* FlexibleSUSY[14] *)
      forcePositiveMasses -> 0,          (* FlexibleSUSY[16] *)
      poleMassScale -> 0,                (* FlexibleSUSY[17] *)
      parameterOutputScale -> 0          (* MODSEL[12] *)
};

fsDefaultSMParameters = {
    alphaEmMZ -> 1/127.916, (* SMINPUTS[1] *)
    GF -> 1.16637*^-5,      (* SMINPUTS[2] *)
    alphaSMZ -> 0.1184,     (* SMINPUTS[3] *)
    MZ -> 91.1876,          (* SMINPUTS[4] *)
    mbmb -> 4.18,           (* SMINPUTS[5] *)
    Mt -> 173.34,           (* SMINPUTS[6] *)
    Mtau -> 1.777,          (* SMINPUTS[7] *)
    Mv3 -> 0,               (* SMINPUTS[8] *)
    MW -> 80.385,           (* SMINPUTS[9] *)
    Me -> 0.000510998902,   (* SMINPUTS[11] *)
    Mv1 -> 0,               (* SMINPUTS[12] *)
    Mm -> 0.1056583715,     (* SMINPUTS[13] *)
    Mv2 -> 0,               (* SMINPUTS[14] *)
    md2GeV -> 0.00475,      (* SMINPUTS[21] *)
    mu2GeV -> 0.0024,       (* SMINPUTS[22] *)
    ms2GeV -> 0.104,        (* SMINPUTS[23] *)
    mcmc -> 1.27,           (* SMINPUTS[24] *)
    alphaEm0 -> 1/137.035999074,
    Mh -> 125.09
};

Options[FS@ModelName@OpenHandle] = {
    fsSettings -> fsDefaultSettings,
    fsSMParameters -> fsDefaultSMParameters
};

FS@ModelName@OpenHandle[OptionsPattern[]] :=
    FS@ModelName@OpenHandleLib[
        {
            (* spectrum generator settings *)
            precisionGoal /. OptionValue[fsSettings],
            maxIterations /. OptionValue[fsSettings],
            calculateStandardModelMasses /. OptionValue[fsSettings],
            poleMassLoopOrder /. OptionValue[fsSettings],
            ewsbLoopOrder /. OptionValue[fsSettings],
            betaFunctionLoopOrder /. OptionValue[fsSettings],
            thresholdCorrectionsLoopOrder /. OptionValue[fsSettings],
            higgs2loopCorrectionAtAs /. OptionValue[fsSettings],
            higgs2loopCorrectionAbAs /. OptionValue[fsSettings],
            higgs2loopCorrectionAtAt /. OptionValue[fsSettings],
            higgs2loopCorrectionAtauAtau /. OptionValue[fsSettings],
            forceOutput /. OptionValue[fsSettings],
            top2loopCorrectionsQCD /. OptionValue[fsSettings],
            betaZeroThreshold /. OptionValue[fsSettings],
            forcePositiveMasses /. OptionValue[fsSettings],
            poleMassScale /. OptionValue[fsSettings],
            parameterOutputScale /. OptionValue[fsSettings],

            (* Standard Model input parameters *)
            alphaEmMZ /. OptionValue[fsSMParameters],
            GF /. OptionValue[fsSMParameters],
            alphaSMZ /. OptionValue[fsSMParameters],
            MZ /. OptionValue[fsSMParameters],
            mbmb /. OptionValue[fsSMParameters],
            Mt /. OptionValue[fsSMParameters],
            Mtau /. OptionValue[fsSMParameters],
            Mv3 /. OptionValue[fsSMParameters],
            MW /. OptionValue[fsSMParameters],
            Me /. OptionValue[fsSMParameters],
            Mv1 /. OptionValue[fsSMParameters],
            Mm /. OptionValue[fsSMParameters],
            Mv2 /. OptionValue[fsSMParameters],
            md2GeV /. OptionValue[fsSMParameters],
            mu2GeV /. OptionValue[fsSMParameters],
            ms2GeV /. OptionValue[fsSMParameters],
            mcmc /. OptionValue[fsSMParameters],
            alphaEm0 /. OptionValue[fsSMParameters],
            Mh /. OptionValue[fsSMParameters]
        }
];

handle = FS@ModelName@OpenHandle[];
FS@ModelName@CalculateSpectrum[handle];
FS@ModelName@CloseHandle[handle];
